@model TGPBlog.Models.Post

@{
    Layout = null;
}


<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
</head>
<body>


    @{
        string Slug = Model.Slug;
        string thisPage = Url.Action("Details", "Posts", new { slug = Slug });
    }

    <div class="row">
        @foreach (var com in Model.Comments)
        {
            <div class="media comments">
                <div class="media-left" style="display:inline-block">
                    <p>@com.Created.DateTime.ToShortDateString()</p>
                </div>

                <div class="media-body">
                    <h6>Commentator: @com.Author.DisplayName</h6>

                    @if (User.IsInRole("Admin") || User.IsInRole("Moderator"))
                    {
                        <form action="@Url.Action("EditComment","Posts")" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="slug" value="@Slug" />
                            <input type="hidden" name="id" value="@com.id" />
                            <input type="hidden" name="PostId" value="@Model.id" />

                            <div class="form-group" >
                                
                                <input type="text" class="form-control" rows="2" style="width:300px" value="@com.Body" name="Body">
                                @Html.ValidationMessageFor(modelComment => com.Body, "", new { @class = "text-danger" })
                            </div>
                            <div class="form-group">
                                <button type="submit" value="Submit" class="btn btn-default">Submit</button>
                            </div>
                        </form>  
                            @Html.ActionLink("Delete","DeletePostComment",
                            new { id = com.id, slug = @Slug },
                            new { onclick = "return confirm('Are you sure you want to delete this comment?');" }) 
                    }
                    else
                    {
                        <p>@com.Body</p>
                    }
                </div>
            </div>
        }
    </div>
    @if (User.Identity.IsAuthenticated)
    {
        <h5 class="margin-b-30">Leave a Comment</h5>
        <form action="@Url.Action("CreateComment","Posts")" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="PostId" value="@Model.id" />
            <div class="form-group">
                <label class="col-sm-2 control-label" style="display:inline-block">Comment by </label>
                <div class="col-sm-10 col-sm-offset-2">
                    <textarea class="form-control" rows="1" name="alias"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label" style="display:inline-block">Comment</label>
                <div class="col-sm-10 col-sm-offset-2">
                    <textarea class="form-control" rows="3" name="Body"></textarea>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-dark btn-lg">Submit</button>
                </div>
            </div>
        </form>
    }
    else
    {
        <br /><hr /><br />
        <h5 class="margin-b-30" style="text-align:center">
            To a Comment, please
            @Html.ActionLink("Log in", "Login", "Account", new { returnUrl = thisPage }, null)
        </h5>
    }

    <div class="space-80"></div>
</body>
</html>
